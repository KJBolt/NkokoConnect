<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Admin access rule -->
        <record id="reminders_rule_admin" model="ir.rule">
            <field name="name">Reminders Admin Rule</field>
            <field name="model_id" ref="model_reminders"/>
            <field name="domain_force">[(1, '=', 1)]</field>  <!-- Always true for admins -->
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <!-- Regular user rule -->
        <record id="reminders_rule_user" model="ir.rule">
            <field name="name">Reminders User Rule</field>
            <field name="model_id" ref="model_reminders"/>
            <field name="domain_force">['|', ('user_id', '=', user.id), ('user_id', '=', False)]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <!-- Reminders Form View -->
        <record id="reminders_form_view" model="ir.ui.view">
            <field name="name">reminders.form.view</field>
            <field name="model">reminders</field>
            <field name="arch" type="xml">
                <form string="Reminders">
                    <header>
                        <button name="set_to_draft" type="object" string="Set to Draft" icon="fa-edit" invisible="status in ['draft', 'ongoing']"/>
                        <button name="cancel_reminder" type="object" string="Cancel Reminder" icon="fa-close" invisible="status in ['draft', 'cancelled']"/>
                        <field name="status" widget="statusbar"/>
                    </header>
                    <sheet>
                        <group string="Feeding and Vaccination Reminders">
                            <group>
                                <field name="farmer_id" readonly="status == 'ongoing'"/>
                                <field name="next_feeding_date" readonly="status == 'ongoing'" />
                            </group>
                            <group>
                                <field name="feeding_plan" readonly="status == 'ongoing'" />
                                <field name="feeding_message" readonly="status == 'ongoing'" />
                            </group>
                            <group>
                                <field name="vaccination_plan" readonly="status == 'ongoing'" />
                                <field name="vaccination_message" readonly="status == 'ongoing'" />
                            </group>
                            <group>
                                <field name="next_vaccination_date" readonly="status == 'ongoing'" />
                            </group>
                        </group>
                    </sheet>
                    <chatter />
                </form>
            </field>
        </record>


        <!-- Reminders List View -->
        <record id="reminders_tree_view" model="ir.ui.view">
            <field name="name">reminders.tree.view</field>
            <field name="model">reminders</field>
            <field name="arch" type="xml">
                <list string="Reminders">
                    <field name="farmer_id" />
                    <field name="status" widget="badge" decoration-success="status == 'ongoing'" decoration-danger="status == 'cancelled'" />
                    <field name="feeding_plan" />
                    <field name="next_feeding_date" />
                    <field name="feeding_message" />
                    <field name="vaccination_plan" />
                    <field name="next_vaccination_date" />
                    <field name="vaccination_message" />
                </list>
            </field>
        </record>

        <!-- Reminders Action -->
        <record id="reminders_action" model="ir.actions.act_window">
            <field name="name">Reminders</field>
            <field name="res_model">reminders</field>
            <field name="view_mode">list,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Reminders.
                </p>
                <p>
                    Manage Reminders.
                </p>
            </field>
        </record>

        <!-- Reminders Menu Item -->
        <menuitem
            id="reminders_menu"
            sequence="3"
            name="Reminders"
            action="reminders_action"
        />
    </data>
</odoo>